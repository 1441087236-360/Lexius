<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lexius</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="lexius-logo.png">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: url('https://cdn.pixabay.com/photo/2020/07/28/11/43/circles-5444818_1280.png') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .chat-wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        header {
            background: linear-gradient(90deg, #0D1B2A, #1B263B, #415A77);
            color: #E0E1DD;
            padding: 1rem;
            text-align: center;
            font-size: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        header img {
            height: 32px;
            width: auto;
        }
        #chatbox {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .message {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            max-width: 75%;
            padding: 0.75rem 1rem;
            border-radius: 24px;
            line-height: 1.4;
            word-wrap: break-word;
            white-space: pre-wrap;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .message span {
            display: block;
            flex: 1;
        }
        .message.bot {
            align-self: flex-start;
            flex-direction: row;
            background-color: rgba(0, 51, 102, 0.35);
            color: black;
        }
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
            background-color: rgba(0, 102, 78, 0.18);
            color: black;
        }
        .message img {
            height: 32px;
            width: 32px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            background: none;
        }
        #userInput {
            flex: 1;
            max-width: 800px;
            min-width: 300px;
            padding: 0.75rem 1rem;
            border: 1px solid black;
            border-radius: 24px;
            font-size: 1rem;
            outline: none;
            resize: none;
            overflow-y: auto;
            max-height: 150px;
            background: none;
            color: black;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.2s, border-color 0.2s;
        }
        #userInput:focus {
            box-shadow: 0 2px 6px solid rgba(255,255,255,0.2);
            border-color: black;
        }
        .send-btn {
            padding: 0.75rem 1.2rem;
            margin-left: 0.5rem;
            background: none;
            color: black;
            border: 1px solid black;
            border-radius: 24px;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s, box-shadow 0.2s, border-color 0.2s;
        }
        .send-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: #fff;
            box-shadow: 0 2px 6px rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <div class="chat-wrapper">
        <header style="display:flex;align-items:center;justify-content:space-between;gap:1rem;">
            <div style="display:flex;align-items:center;gap:0.5rem;">
                <img src="lexius-logo.png" alt="Lexius Logo" style="height:32px;width:auto;">
                <span style="font-size:1.5rem;">Lexius</span>
            </div>
            <div style="display:flex;align-items:center;gap:1rem;">
                <div id="user-profile" style="display:flex;align-items:center;gap:0.5rem;">
                    <img id="user-avatar" src="https://ui-avatars.com/api/?name=User" alt="User Avatar" style="height:32px;width:32px;border-radius:50%;object-fit:cover;cursor:pointer;border:2px solid #E0E1DD;">
                    <span id="user-email" style="font-size:1rem;">user@email.com</span>
                    <button id="settingsBtn" aria-label="Settings" style="background:none;border:none;cursor:pointer;padding:0 0.3rem;">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7Zm7.43-2.9c.04-.32.07-.65.07-.98s-.03-.66-.07-.98l2.11-1.65a.5.5 0 0 0 .12-.64l-2-3.46a.5.5 0 0 0-.6-.22l-2.49 1a7.03 7.03 0 0 0-1.7-.98l-.38-2.65A.5.5 0 0 0 13 2h-4a.5.5 0 0 0-.5.42l-.38 2.65c-.63.25-1.22.58-1.7.98l-2.49-1a.5.5 0 0 0-.6.22l-2 3.46a.5.5 0 0 0 .12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65a.5.5 0 0 0-.12.64l2 3.46c.14.24.44.32.68.22l2.49-1c.53.4 1.1.73 1.7.98l.38 2.65c.05.28.27.42.5.42h4c.23 0 .45-.14.5-.42l.38-2.65c.63-.25 1.22-.58 1.7-.98l2.49 1c.24.1.54.02.68-.22l2-3.46a.5.5 0 0 0-.12-.64l-2.11-1.65Z" stroke="#E0E1DD" stroke-width="1.5"/></svg>
                    </button>
                </div>
                <button id="authBtn" style="background:none;border:1px solid #E0E1DD;border-radius:16px;padding:0.3rem 0.8rem;cursor:pointer;color:#E0E1DD;font-size:1rem;">Logout</button>
            </div>
        </header>

        <div id="chatbox"></div>

        <!-- Copilot/ChatGPT style input bar, full reference markup, at the bottom -->
        <div class="flex w-full cursor-text flex-col items-center justify-center rounded-[28px] bg-clip-padding contain-inline-size overflow-clip border-token-border-default border shadow-sm sm:shadow-lg dark:shadow-none! bg-token-bg-primary dark:bg-[#303030]">
          <div class="relative flex w-full items-end px-3 py-3">
            <div class="relative flex w-full flex-auto flex-col">
              <div class="relative ms-1.5 grid grid-cols-[auto_minmax(0,1fr)]">
                <div class="items-top flex justify-center"><div style="opacity:1"></div></div>
                <div class="relative flex-auto bg-transparent pt-0.5" style="margin-bottom:-20px;transform:translateY(-7px)">
                  <div class="flex flex-col justify-start" style="min-height:0">
                    <div class="flex min-h-12 items-start">
                      <div class="max-w-full min-w-0 flex-1">
                        <div class="_prosemirror-parent_kfgfu_2 text-token-text-primary max-h-[25dvh] max-h-52 -mx-3 px-3 overflow-auto [scrollbar-width:thin] default-browser vertical-scroll-fade-mask min-h-12 pe-3">
                          <div contenteditable="true" translate="no" class="ProseMirror" id="prompt-textarea" data-virtualkeyboard="true" style="outline:none;min-height:24px;"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="justify-content-end relative ms-2 flex w-full flex-auto flex-col"><div class="flex-auto"></div></div>
              <div style="height:48px"></div>
            </div>
            <div class="bg-primary-surface-primary absolute start-3 end-0 bottom-3 z-2 flex items-center">
              <div class="w-full">
                <div class="absolute end-3 bottom-0 flex items-center gap-2" data-testid="composer-trailing-actions">
                  <div class="ms-auto flex items-center gap-1.5">
                    <span class="" data-state="closed">
                      <button id="composer-submit-button" aria-label="Send prompt" data-testid="send-button" class="dark:disabled:bg-token-text-quaternary dark:disabled:text-token-main-surface-secondary flex items-center justify-center rounded-full transition-colors hover:opacity-70 disabled:text-[#f4f4f4] disabled:hover:opacity-100 dark:focus-visible:outline-white bg-black text-white disabled:bg-[#D7D7D7] dark:bg-white dark:text-black h-9 w-9">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-md"><path d="M7.99992 14.9993V5.41334L4.70696 8.70631C4.31643 9.09683 3.68342 9.09683 3.29289 8.70631C2.90237 8.31578 2.90237 7.68277 3.29289 7.29225L8.29289 2.29225L8.36906 2.22389C8.76184 1.90354 9.34084 1.92613 9.70696 2.29225L14.707 7.29225L14.7753 7.36842C15.0957 7.76119 15.0731 8.34019 14.707 8.70631C14.3408 9.07242 13.7618 9.09502 13.3691 8.77467L13.2929 8.70631L9.99992 5.41334V14.9993C9.99992 15.5516 9.55221 15.9993 8.99992 15.9993C8.44764 15.9993 7.99993 15.5516 7.99992 14.9993Z" fill="currentColor"></path></svg>
                      </button>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="absolute start-4 top-3 ms-[1px] flex items-center pb-px"></div>
          </div>
          <div class="w-full"></div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);z-index:1000;align-items:center;justify-content:center;">
          <div style="background:#fff;padding:2rem 2.5rem;border-radius:18px;min-width:320px;max-width:90vw;box-shadow:0 4px 24px #0003;position:relative;">
            <button onclick="document.getElementById('settingsModal').style.display='none'" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer;">&times;</button>
            <h2 style="margin-top:0;">User Profile</h2>
            <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem;">
              <img id="modal-avatar" src="https://ui-avatars.com/api/?name=User" alt="User Avatar" style="height:48px;width:48px;border-radius:50%;object-fit:cover;border:2px solid #E0E1DD;">
              <input type="file" id="avatarUpload" accept="image/*" style="display:none;">
              <button onclick="document.getElementById('avatarUpload').click()" style="background:#415A77;color:#fff;border:none;border-radius:8px;padding:0.4rem 1rem;cursor:pointer;">Change Avatar</button>
            </div>
            <div style="margin-bottom:1rem;">
              <label for="modal-email" style="font-weight:bold;">Email:</label><br>
              <input id="modal-email" type="email" value="user@email.com" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;">
            </div>
            <button style="background:#0D1B2A;color:#fff;border:none;border-radius:8px;padding:0.6rem 1.5rem;font-size:1rem;cursor:pointer;">Save</button>
          </div>
        </div>

    <script>
        const chatbox = document.getElementById('chatbox');
        const userInput = document.getElementById('userInput');
        const sendBtn   = document.getElementById('sendBtn');

        // Auto-resize textarea
        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
        });

        function appendMessage(text, sender) {
            const msg = document.createElement('div');
            msg.classList.add('message', sender);

            const logo = document.createElement('img');
            logo.src = 'lexius-logo.png';
            logo.alt = sender === 'bot' ? 'Bot Logo' : 'User Logo';

            const span = document.createElement('span');
            span.textContent = text;

            msg.appendChild(logo);
            msg.appendChild(span);
            chatbox.appendChild(msg);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        async function loadChatHistory() {
            try {
                const res = await fetch('/history');
                const msgs = await res.json();
                msgs.forEach(m => appendMessage(m.text, m.sender));
            } catch (e) {
                console.error('Failed to load history', e);
            }
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            userInput.value = '';
            userInput.style.height = 'auto';

            try {
                const res = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                const { response } = await res.json();
                appendMessage(response, 'bot');
            } catch (err) {
                appendMessage('⚠️ Error communicating with server', 'bot');
                console.error(err);
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Load history on start
        window.onload = loadChatHistory;
            
            const userInput = document.getElementById('userInput');
            const sendBtn   = document.getElementById('sendBtn');
        
    </script>
</body>
</html>